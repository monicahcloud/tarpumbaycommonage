generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String       @id @default(cuid())
  clerkId      String       @unique
  email        String       @unique
  firstName    String?
  lastName     String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  applications Application?
}

model Application {
  id              String       @id @default(cuid())
  userId          String       @unique
  firstName       String
  lastName        String
  email           String
  phone           String?
  dob             DateTime?
  address         String?
  ancestry        String?
  purpose         String
  signature       String?
  status          AppStatus    @default(DRAFT)
  submittedAt     DateTime?
  updatedAt       DateTime     @updatedAt
  createdAt       DateTime     @default(now())
  adminNote       String?
  feeAmount       Int?
  feePaidAt       DateTime?
  feesPaid        Boolean      @default(false)
  lotNumber       String?
  nextSteps       String?
  rejectionReason String?
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments     Attachment[]
  statusLogs      StatusLog[]

  @@index([userId])
  @@index([status, createdAt])
}

model Attachment {
  id            String         @id @default(cuid())
  applicationId String
  kind          AttachmentKind
  url           String
  contentType   String
  size          Int?
  createdAt     DateTime       @default(now())
  label         String?
  pathname      String?
  application   Application    @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

model StatusLog {
  id            String      @id @default(cuid())
  applicationId String
  changedBy     String
  fromStatus    AppStatus
  toStatus      AppStatus
  note          String?
  createdAt     DateTime    @default(now())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId, createdAt])
}

model News {
  id        String        @id @default(cuid())
  slug      String        @unique
  title     String
  excerpt   String?
  contentMd String
  status    PublishStatus @default(DRAFT)
  publishAt DateTime?
  createdBy String
  updatedBy String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model Announcement {
  id        String        @id @default(cuid())
  title     String
  contentMd String
  status    PublishStatus @default(DRAFT)
  publishAt DateTime?
  createdBy String
  updatedBy String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model Faq {
  id         String        @id @default(cuid())
  question   String
  answerMd   String
  category   String?
  orderIndex Int           @default(0)
  status     PublishStatus @default(DRAFT)
  createdBy  String
  updatedBy  String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@index([category, orderIndex])
}

model Event {
  id            String        @id @default(cuid())
  slug          String        @unique
  title         String
  descriptionMd String?
  status        PublishStatus @default(DRAFT)
  startsAt      DateTime
  endsAt        DateTime
  allDay        Boolean       @default(false)
  location      String?
  isVirtual     Boolean       @default(false)
  zoomJoinUrl   String?
  zoomPasscode  String?
  createdBy     String
  updatedBy     String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([status, startsAt])
}

model Document {
  id          String      @id @default(cuid())
  title       String
  slug        String      @unique
  description String?
  category    DocCategory
  tags        String[]    @default([])
  fileUrl     String
  contentType String?
  size        Int?
  pinned      Boolean     @default(false)
  status      DocStatus   @default(PUBLISHED)
  createdAt   DateTime    @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime    @default(now()) @updatedAt @db.Timestamptz(6)

  @@index([status, updatedAt])
  @@index([category])
}

enum AppStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
}

enum AttachmentKind {
  ID_PASSPORT
  BIRTH_CERT
  DRAWINGS
  PROOF_OF_ADDRESS
  OTHER
}

enum PublishStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum DocCategory {
  BYLAWS
  POLICY
  FORM
  MEETING_MINUTES
  GUIDE
  OTHER
}

enum DocStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}
